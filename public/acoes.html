<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/styles.css">
  <title>Themis Data - menu</title>

  <style>
    .main-content {
      max-width: 1400px;
      margin: 0 auto;
    }


    @media (max-width: 768px) {
      .header {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }

      .main-content {
        padding: 1rem;
      }

    }

    /* Botão criar, acompanhar e corrigir */
    .aba-btn {
      padding: 0.7rem 1.5rem;
      border: none;
      border-radius: 6px;
      background: #667eea;
      color: #fff;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .aba-btn.ativo,
    .aba-btn:hover {
      background: #4953b8;
    }

    .aba-section {
      margin-top: 1.5rem;
    }

    /*Card principal da criação da ação */
    .form-acao {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
      padding: 2rem 1.5rem 0.2rem 1.5rem;
      max-width: 120%;
      margin-top: 1%;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .form-row {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1 1 220px;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .form-group label {
      font-weight: 500;
      color: #4953b8;
      margin-bottom: 0.1rem;
    }

    .form-group select {
      padding: 0.5rem 0.7rem;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      background: #f8f9fa;
      transition: border 0.2s;
    }

    .form-group select:focus {
      border: 1.5px solid #667eea;
      outline: none;
    }

    .dica {
      font-size: 0.85em;
      color: #888;
      margin-top: -0.1rem;
    }

    .req {
      color: #e53e3e;
      font-size: 1em;
    }

    .btn-criar {
      background: linear-gradient(90deg, #667eea 60%, #4953b8 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.8rem 2.2rem;
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 0.5rem;
      margin-bottom: 0.1rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.08);
      transition: background 0.2s, box-shadow 0.2s;
      width: 30%;
      align-self: flex-end;
      min-width: 120px;
      max-width: 250px;
    }

    @media (max-width: 700px) {
      .btn-criar {
        width: 100%;
        max-width: 100%;
        align-self: stretch;
      }
    }

    .btn-criar:hover {
      background: linear-gradient(90deg, #4953b8 60%, #667eea 100%);
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.13);
    }

    .mensagem {
      margin-top: 0.7rem;
      font-size: 1.05em;
      min-height: 1.2em;
      color: #4953b8;
      font-weight: 500;
      text-align: center;
    }

    @media (max-width: 600px) {
      .form-row {
        flex-direction: column;
        gap: 0.7rem;
      }

      .form-acao {
        padding: 1rem 0.5rem;
      }
    }

    .form-input {
      padding: 0.5rem 0.7rem;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      background: #f8f9fa;
      transition: border 0.2s;
    }

    .form-input:focus {
      border: 1.5px solid #667eea;
      outline: none;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 1.2rem;
    }

    .file-upload-row {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1.2rem;
      width: 100%;
    }

    .file-upload-row .form-group {
      flex: 1 1 0;
      min-width: 0;
      max-width: 100%;
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 700px) {
      .form-grid {
        grid-template-columns: 1fr;
        gap: 0.7rem;
      }

      .file-upload-row {
        flex-direction: column;
        gap: 0.7rem;
      }
    }

    .file-drop {
      border: 2px dashed #667eea;
      border-radius: 8px;
      background: #f8f9fa;
      padding: 1.2rem 0.5rem;
      text-align: center;
      cursor: pointer;
      transition: border 0.2s, background 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 90px;
      position: relative;
    }

    .file-drop:hover,
    .file-drop.dragover {
      border-color: #4953b8;
      background: #e9eafc;
    }

    .file-drop input[type="file"] {
      display: none;
    }

    .file-drop .icon {
      font-size: 2.2rem;
      color: #667eea;
      margin-bottom: 0.3rem;
    }

    .file-drop .file-name {
      font-size: 0.98rem;
      color: #4953b8;
      margin-top: 0.2rem;
      word-break: break-all;
    }

    .file-list {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      width: 100%;
    }

    .file-list-item {
      display: flex;
      align-items: center;
      background: #eef1fa;
      border-radius: 4px;
      padding: 0.2rem 0.7rem 0.2rem 0.4rem;
      font-size: 0.97rem;
      color: #4953b8;
      justify-content: space-between;
      max-width: 100%;
    }

    .file-list-item .remove-file {
      color: #e53e3e;
      font-weight: bold;
      margin-left: 0.7rem;
      cursor: pointer;
      font-size: 1.1em;
      border: none;
      background: none;
      outline: none;
      transition: color 0.2s;
    }

    .file-list-item .remove-file:hover {
      color: #b91c1c;
    }

    /* Estilos do Kanban */
    .kanban-container {
      width: 100%;
      overflow-x: auto;
      padding: 1rem 0;
    }

    .kanban-board {
      margin-top: -24px;
      display: flex;
      gap: 1.5rem;
      min-width: max-content;
      padding: 0.5rem;
    }

    .kanban-column {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 1rem;
      min-width: 300px;
      max-width: 350px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e9ecef;
    }

    .kanban-column-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #667eea;
    }

    .kanban-column-title {
      font-weight: 600;
      color: #4953b8;
      font-size: 1.1rem;
    }

    .kanban-column-count {
      background: #667eea;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .kanban-cards {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      min-height: 200px;
    }

    .kanban-card {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #667eea;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .kanban-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .kanban-card-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .kanban-card-cliente {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
    }

    .kanban-card-status {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .status-nao-iniciado {
      background: #fff3cd;
      color: #856404;
    }

    .status-em-andamento {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status-finalizado {
      background: #d4edda;
      color: #155724;
    }

    .kanban-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #888;
    }

    .kanban-card-criador {
      font-style: italic;
    }

    .kanban-card-data {
      color: #999;
    }

    @media (max-width: 768px) {
      .kanban-board {
        flex-direction: column;
        gap: 1rem;
      }

      .kanban-column {
        min-width: 100%;
        max-width: 100%;
      }
    }

    /* Modal de documentos */
    .modal-docs {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-docs-bg {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.35);
    }

    .modal-docs-content {
      position: relative;
      background: #fff;
      border-radius: 10px;
      padding: 2rem 2.5rem 1.5rem 2.5rem;
      min-width: 320px;
      max-width: 95vw;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .modal-docs-close {
      position: absolute;
      top: 0.7rem;
      right: 1.2rem;
      background: none;
      border: none;
      font-size: 2rem;
      color: #4953b8;
      cursor: pointer;
      font-weight: bold;
    }

    .modal-docs-content h3 {
      margin-top: 0;
      margin-bottom: 1.2rem;
      color: #4953b8;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-docs-lista {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .modal-docs-item {
      display: flex;
      align-items: center;
      gap: 0.7rem;
      background: #f8f9fa;
      border-radius: 6px;
      padding: 0.7rem 1rem;
      font-size: 1rem;
      color: #4953b8;
      box-shadow: 0 1px 4px rgba(102, 126, 234, 0.07);
    }

    .modal-docs-link {
      color: #667eea;
      text-decoration: underline;
      font-weight: 500;
      margin-left: auto;
    }

    .modal-docs-link:hover {
      color: #4953b8;
    }

    .modal-docs-tipos {
      display: flex;
      gap: 1.5rem;
      width: 100%;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .modal-docs-bloco {
      flex: 1 1 0;
      min-width: 220px;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: 0 1px 4px rgba(102, 126, 234, 0.07);
      margin-bottom: 1rem;
    }

    .modal-docs-bloco-titulo {
      font-weight: 600;
      color: #4953b8;
      margin-bottom: 0.7rem;
      font-size: 1.05rem;
    }

    .modal-docs-arquivos {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      width: 100%;
    }

    .modal-docs-arquivo-card {
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 6px;
      padding: 0.5rem 0.8rem;
      font-size: 0.98rem;
      color: #4953b8;
      box-shadow: 0 1px 4px rgba(102, 126, 234, 0.07);
      gap: 0.7rem;
    }

    .modal-docs-arquivo-icon {
      font-size: 1.3rem;
      color: #667eea;
      margin-right: 0.5rem;
    }

    .modal-docs-arquivo-nome {
      flex: 1;
      word-break: break-all;
    }

    .modal-docs-arquivo-link {
      color: #667eea;
      text-decoration: underline;
      font-weight: 500;
      margin-left: 0.7rem;
      font-size: 1.1em;
    }

    .modal-docs-arquivo-link:hover {
      color: #4953b8;
    }

    .modal-docs-arquivo-remove {
      background: none;
      border: none;
      font-size: 1.2em;
      color: #e53e3e;
      cursor: pointer;
      font-weight: bold;
      padding: 0;
      margin-left: 0.7rem;
    }

    .modal-docs-arquivo-remove:hover {
      color: #b91c1c;
    }

    .modal-docs-upload-row {
      display: flex;
      align-items: center;
      gap: 0.7rem;
      margin-bottom: 0.7rem;
      width: 100%;
    }

    .modal-docs-upload-input {
      flex: 1;
      padding: 0.4rem 0.7rem;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      background: #f8f9fa;
      transition: border 0.2s;
    }

    .modal-docs-upload-btn {
      background: linear-gradient(90deg, #667eea 60%, #4953b8 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.08);
      transition: background 0.2s, box-shadow 0.2s;
    }

    .modal-docs-upload-btn:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }

    .modal-docs-upload-drop {
      border: 2px dashed #667eea;
      border-radius: 8px;
      background: #f8f9fa;
      padding: 1.2rem 0.5rem;
      text-align: center;
      cursor: pointer;
      transition: border 0.2s, background 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 90px;
      position: relative;
      width: 100%;
      margin-bottom: 0.7rem;
    }

    .modal-docs-upload-drop:hover,
    .modal-docs-upload-drop.dragover {
      border-color: #4953b8;
      background: #e9eafc;
    }

    .modal-docs-upload-drop input[type="file"] {
      display: none;
    }

    .modal-docs-upload-drop .icon {
      font-size: 2.2rem;
      color: #667eea;
      margin-bottom: 0.3rem;
    }

    .modal-docs-upload-drop .file-name {
      font-size: 0.98rem;
      color: #4953b8;
      margin-top: 0.2rem;
      word-break: break-all;
    }

    /* Selo de aprovado no kanban corrigir */
    .kanban-aprovado-selo {
      display: inline-block;
      background: #28a745;
      color: #fff;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 600;
      padding: 0.2em 0.8em;
      margin-left: 0.7em;
      vertical-align: middle;
    }
  </style>

</head>

<body>
  <header class="header">
    <div class="logo-header" onclick="window.location.href='/menu'" style="cursor:pointer;">
      <img src="images/logo.png" alt="Themis Data Logo">
      <h1>Themis Data</h1>
    </div>
    <div class="user-info">
      <div class="user-avatar">
        <img id="userAvatar" alt="Avatar do usuário"
          onerror="this.style.display='none'; document.querySelector('.fallback').style.display='flex';">
        <div class="fallback" id="userAvatarFallback">?</div>
      </div>
      <div style="display: flex; flex-direction: column; align-items: flex-start;">
        <span id="userNome"></span>
        <span id="userNivelAcesso" style="font-size:0.95em; color:#667eea; font-weight:500;"></span>
      </div>
      <button class="menu-toggle" onclick="toggleMenu()">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </button>
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="/usuarios">👥 Editar Usuários</a>
        <a href="#" onclick="alterarSenha()">🔒 Alterar Senha</a>
        <a href="#" onclick="configuracoes()">⚙️ Configurações</a>
        <a href="#" onclick="ajuda()">❓ Ajuda</a>
        <a href="/" class="logout-option">🚪 Sair</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div style="display: flex; gap: 1rem;">
      <button type="button" class="aba-btn" onclick="mostrarAba('criar')">Criar Ação</button>
      <button type="button" class="aba-btn" onclick="mostrarAba('acompanhar')">Acompanhar Ações</button>
      <button type="button" class="aba-btn" onclick="mostrarAba('corrigir')">Corrigir Ações</button>
    </div>

    <section id="aba-criar" class="aba-section">
      <form id="formAcao" autocomplete="off" class="form-acao">
        <div class="form-grid">
          <div class="form-group">
            <label for="cliente">Cliente <span class="req">*</span></label>
            <select id="cliente" name="cliente" required>
              <option value="">Selecione um cliente...</option>
            </select>
            <small class="dica">Escolha o cliente relacionado à ação.</small>
          </div>
          <div class="form-group">
            <label for="designado">Designado <span class="req">*</span></label>
            <select id="designado" name="designado" required>
              <option value="">Selecione um usuário...</option>
              <option value="Nenhum">Nenhum</option>
            </select>
            <small class="dica">Selecione quem irá executar a ação.</small>
          </div>
          <div class="form-group">
            <label for="status">Status <span class="req">*</span></label>
            <select id="status" name="status" required>
              <option value="Não iniciado">Não iniciado</option>
              <option value="Em andamento">Em andamento</option>
              <option value="Finalizado">Finalizado</option>
            </select>
            <small class="dica">Defina o status inicial da ação.</small>
          </div>
          <div class="form-group">
            <label for="titulo">Título da Ação <span class="req">*</span></label>
            <input type="text" id="titulo" name="titulo" required placeholder="Digite o título da ação..."
              class="form-input">
            <small class="dica">Informe um título breve e descritivo para a ação.</small>
          </div>
        </div>
        <div class="file-upload-row">
          <div class="form-group">
            <label for="contratoArquivo">Contrato</label>
            <div class="file-drop" id="drop-contrato" onclick="document.getElementById('contratoArquivo').click();">
              <span class="icon">📎</span>
              <span id="contratoArquivoLabel">Arraste o arquivo aqui ou clique para selecionar</span>
              <span class="file-name" id="contratoArquivoNome"></span>
              <input type="file" id="contratoArquivo" name="contratoArquivo" accept=".pdf,.doc,.docx,.png,.jpg,.jpeg"
                multiple style="display:none;">
              <div class="file-list" id="contratoArquivoLista"></div>
            </div>
            <small class="dica">Anexe o contrato relacionado à ação.</small>
          </div>
          <div class="form-group">
            <label for="documentacaoArquivo">Documentação</label>
            <div class="file-drop" id="drop-documentacao"
              onclick="document.getElementById('documentacaoArquivo').click();">
              <span class="icon">📎</span>
              <span id="documentacaoArquivoLabel">Arraste o arquivo aqui ou clique para selecionar</span>
              <span class="file-name" id="documentacaoArquivoNome"></span>
              <input type="file" id="documentacaoArquivo" name="documentacaoArquivo"
                accept=".pdf,.doc,.docx,.png,.jpg,.jpeg" multiple style="display:none;">
              <div class="file-list" id="documentacaoArquivoLista"></div>
            </div>
            <small class="dica">Anexe documentação complementar.</small>
          </div>
          <div class="form-group">
            <label for="provasArquivo">Provas</label>
            <div class="file-drop" id="drop-provas" onclick="document.getElementById('provasArquivo').click();">
              <span class="icon">📎</span>
              <span id="provasArquivoLabel">Arraste o arquivo aqui ou clique para selecionar</span>
              <span class="file-name" id="provasArquivoNome"></span>
              <input type="file" id="provasArquivo" name="provasArquivo" accept=".pdf,.doc,.docx,.png,.jpg,.jpeg"
                multiple style="display:none;">
              <div class="file-list" id="provasArquivoLista"></div>
            </div>
            <small class="dica">Anexe arquivos de provas, se houver.</small>
          </div>
        </div>
        <button type="submit" class="btn-criar">Criar Ação</button>
        <div id="mensagem" class="mensagem"></div>
      </form>
    </section>

    <section id="aba-acompanhar" class="aba-section" style="display:none">
      <div class="kanban-container">
        <div class="kanban-board" id="kanbanBoard">
          <!-- Colunas serão criadas dinamicamente -->
        </div>
      </div>
    </section>

    <section id="aba-corrigir" class="aba-section" style="display:none">
      <div class="kanban-container">
        <div class="kanban-board" id="kanbanBoardCorrigir">
          <!-- Colunas serão criadas dinamicamente -->
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de Documentos da Ação -->
  <div id="modalDocumentos" class="modal-docs" style="display:none;">
    <div class="modal-docs-bg" onclick="fecharModalDocumentos()"></div>
    <div class="modal-docs-content">
      <button class="modal-docs-close" onclick="fecharModalDocumentos()">×</button>
      <div id="modalDocsLista"></div>
    </div>
  </div>

  <script>
    // Alterna entre as abas
    function mostrarAba(aba) {
      document.getElementById('aba-criar').style.display = aba === 'criar' ? 'block' : 'none';
      document.getElementById('aba-acompanhar').style.display = aba === 'acompanhar' ? 'block' : 'none';
      document.getElementById('aba-corrigir').style.display = aba === 'corrigir' ? 'block' : 'none';
      // Opcional: destaque visual no botão ativo
      document.querySelectorAll('.aba-btn').forEach(btn => btn.classList.remove('ativo'));
      if (aba === 'criar') document.querySelectorAll('.aba-btn')[0].classList.add('ativo');
      if (aba === 'acompanhar') document.querySelectorAll('.aba-btn')[1].classList.add('ativo');
      if (aba === 'corrigir') document.querySelectorAll('.aba-btn')[2].classList.add('ativo');
      // Carregar kanban quando a aba for aberta
      if (aba === 'acompanhar') {
        carregarKanban();
      }
      if (aba === 'corrigir') {
        carregarKanbanCorrigir();
      }
    }

    // Função para carregar o kanban
    async function carregarKanban() {
      try {
        const response = await fetch('/api/acoes');
        const acoesPorDesignado = await response.json();

        const kanbanBoard = document.getElementById('kanbanBoard');
        kanbanBoard.innerHTML = '';

        // Ordenar: 'Nenhum' primeiro, depois os demais em ordem alfabética
        const designados = Object.keys(acoesPorDesignado);
        designados.sort((a, b) => {
          if (a === 'Nenhum') return -1;
          if (b === 'Nenhum') return 1;
          return a.localeCompare(b, 'pt-BR');
        });
        designados.forEach(designado => {
          const acoes = acoesPorDesignado[designado];
          const coluna = criarColunaKanban(designado, acoes);
          kanbanBoard.appendChild(coluna);
        });

        // Se não houver ações, mostrar mensagem
        if (Object.keys(acoesPorDesignado).length === 0) {
          kanbanBoard.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">Nenhuma ação encontrada</p>';
        }
      } catch (error) {
        console.error('Erro ao carregar kanban:', error);
        document.getElementById('kanbanBoard').innerHTML = '<p style="text-align: center; color: #dc3545;">Erro ao carregar ações</p>';
      }
    }

    // Função para criar uma coluna do kanban
    function criarColunaKanban(designado, acoes) {
      const coluna = document.createElement('div');
      coluna.className = 'kanban-column';

      const header = document.createElement('div');
      header.className = 'kanban-column-header';

      const title = document.createElement('div');
      title.className = 'kanban-column-title';
      title.textContent = designado;

      const count = document.createElement('div');
      count.className = 'kanban-column-count';
      count.textContent = acoes.length;

      header.appendChild(title);
      header.appendChild(count);

      const cardsContainer = document.createElement('div');
      cardsContainer.className = 'kanban-cards';

      // Criar cards para cada ação
      acoes.forEach(acao => {
        const card = criarCardAcao(acao);
        cardsContainer.appendChild(card);
      });

      coluna.appendChild(header);
      coluna.appendChild(cardsContainer);

      return coluna;
    }

    // Função para criar um card de ação
    function criarCardAcao(acao) {
      const card = document.createElement('div');
      card.className = 'kanban-card';
      card.onclick = () => abrirDetalhesAcao(acao.id);

      const statusClass = acao.status.replace(/\s+/g, '-').toLowerCase();
      const dataFormatada = new Date(acao.data_criacao).toLocaleDateString('pt-BR');

      card.innerHTML = `
        <div class="kanban-card-title">${acao.titulo}</div>
        <div class="kanban-card-cliente">👤 ${acao.cliente}</div>
        <div class="kanban-card-status status-${statusClass}">${acao.status}</div>
        <div class="kanban-card-meta">
          <span class="kanban-card-criador">Por: ${acao.criador}</span>
          <span class="kanban-card-data">${dataFormatada}</span>
        </div>
      `;

      return card;
    }

    // Função para abrir detalhes da ação (placeholder)
    async function abrirDetalhesAcao(acaoId) {
      // Buscar arquivos e status da ação pela nova rota
      try {
        // Buscar arquivos
        const respArq = await fetch(`/api/acoes/arquivos/${acaoId}`);
        const arquivosPorTipo = await respArq.json();
        // Buscar status
        const respStatus = await fetch(`/api/acoes/status/${acaoId}`);
        const dadosStatus = await respStatus.json();
        mostrarModalDocumentosAcompanhamento(acaoId, arquivosPorTipo, dadosStatus.status);
      } catch (e) {
        alert('Erro ao buscar arquivos ou status da ação.');
      }
    }

    // Função para carregar o kanban de corrigir ações (apenas finalizadas)
    async function carregarKanbanCorrigir() {
      try {
        const response = await fetch('/api/acoes?status=finalizado');
        const acoesPorDesignado = await response.json();
        const kanbanBoard = document.getElementById('kanbanBoardCorrigir');
        kanbanBoard.innerHTML = '';
        // Ordenar: 'Nenhum' primeiro, depois os demais em ordem alfabética
        const designados = Object.keys(acoesPorDesignado);
        designados.sort((a, b) => {
          if (a === 'Nenhum') return -1;
          if (b === 'Nenhum') return 1;
          return a.localeCompare(b, 'pt-BR');
        });
        designados.forEach(designado => {
          const acoes = acoesPorDesignado[designado];
          const coluna = criarColunaKanbanCorrigir(designado, acoes);
          kanbanBoard.appendChild(coluna);
        });
        if (Object.keys(acoesPorDesignado).length === 0) {
          kanbanBoard.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">Nenhuma ação finalizada para corrigir</p>';
        }
      } catch (error) {
        document.getElementById('kanbanBoardCorrigir').innerHTML = '<p style="text-align: center; color: #dc3545;">Erro ao carregar ações</p>';
      }
    }

    // Coluna e card para corrigir (idêntico, mas chama modalCorrigir)
    function criarColunaKanbanCorrigir(designado, acoes) {
      const coluna = document.createElement('div');
      coluna.className = 'kanban-column';
      const header = document.createElement('div');
      header.className = 'kanban-column-header';
      const title = document.createElement('div');
      title.className = 'kanban-column-title';
      title.textContent = designado;
      const count = document.createElement('div');
      count.className = 'kanban-column-count';
      count.textContent = acoes.length;
      header.appendChild(title);
      header.appendChild(count);
      const cardsContainer = document.createElement('div');
      cardsContainer.className = 'kanban-cards';
      acoes.forEach(acao => {
        const card = document.createElement('div');
        card.className = 'kanban-card';
        card.onclick = () => abrirDetalhesAcaoCorrigir(acao.id);
        const statusClass = acao.status.replace(/\s+/g, '-').toLowerCase();
        const dataFormatada = new Date(acao.data_criacao).toLocaleDateString('pt-BR');
        let aprovadoSelo = '';
        if (acao.data_aprovado) {
          aprovadoSelo = `<span class='kanban-aprovado-selo'>Aprovado</span>`;
        }
        card.innerHTML = `
          <div class="kanban-card-title">${acao.titulo}</div>
          <div class="kanban-card-cliente">👤 ${acao.cliente}</div>
          <div class="kanban-card-status status-${statusClass}">${acao.status} ${aprovadoSelo}</div>
          <div class="kanban-card-meta">
            <span class="kanban-card-criador">Por: ${acao.criador}</span>
            <span class="kanban-card-data">${dataFormatada}</span>
          </div>
        `;
        cardsContainer.appendChild(card);
      });
      coluna.appendChild(header);
      coluna.appendChild(cardsContainer);
      return coluna;
    }

    // Modal de corrigir ação (idêntico, mas com botão Aprovar)
    async function abrirDetalhesAcaoCorrigir(acaoId) {
      // Buscar arquivos e status da ação pela nova rota
      try {
        // Buscar arquivos
        const respArq = await fetch(`/api/acoes/arquivos/${acaoId}`);
        const arquivosPorTipo = await respArq.json();
        // Buscar status
        const respStatus = await fetch(`/api/acoes/status/${acaoId}`);
        const dadosStatus = await respStatus.json();
        mostrarModalDocumentosAcompanhamento(acaoId, arquivosPorTipo, dadosStatus.status, true);
      } catch (e) {
        alert('Erro ao buscar arquivos ou status da ação.');
      }
    }

    function mostrarModalDocumentosAcompanhamento(acaoId, arquivosPorTipo, statusAtual, modoCorrigir) {
      const modal = document.getElementById('modalDocumentos');
      const lista = document.getElementById('modalDocsLista');
      lista.innerHTML = '';
      // Campo de status editável na mesma linha do título do modal
      const modalContent = document.querySelector('.modal-docs-content');
      let headerRow = document.getElementById('modalDocsHeaderRow');
      if (headerRow) headerRow.remove();
      headerRow = document.createElement('div');
      headerRow.id = 'modalDocsHeaderRow';
      headerRow.style.display = 'flex';
      headerRow.style.alignItems = 'center';
      headerRow.style.justifyContent = 'space-between';
      headerRow.style.width = '100%';
      headerRow.style.marginBottom = '1.2rem';
      headerRow.innerHTML = `
        <h3 style='margin:0;color:#4953b8;font-size:1.25rem;font-weight:600;'>Documentos da Ação</h3>
        <div style='display:flex;align-items:center;gap:1rem;'>
          <span style="font-size:1.1rem;font-weight:600;color:#4953b8;">Designado:</span>
          <select id="modalDesignadoSelect" style="padding:0.4rem 1rem;border-radius:6px;font-size:1rem;min-width:120px;"></select>
          <span style="font-size:1.1rem;font-weight:600;color:#4953b8;">Status:</span>
          <select id="modalStatusSelect" style="padding:0.4rem 1rem;border-radius:6px;font-size:1rem;">
            <option value="Não iniciado">Não iniciado</option>
            <option value="Em andamento">Em andamento</option>
            ${modoCorrigir ? '<option value="Devolvido">Devolvido</option>' : ''}
            <option value="Finalizado">Finalizado</option>
          </select>
          <button id="modalStatusSalvar" class="modal-docs-upload-btn" style="padding:0.4rem 1.2rem;">Salvar</button>
          ${modoCorrigir ? `<button id="modalAprovar" class="modal-docs-upload-btn" style="padding:0.4rem 1.2rem;background:#28a745;">Aprovar</button>` : ''}
          <span id="modalStatusMsg" style="margin-left:0.7rem;font-size:0.98rem;"></span>
        </div>
      `;
      modalContent.insertBefore(headerRow, modalContent.querySelector('#modalDocsLista'));

      // Exibir comentário se existir e não for modo de correção
      let comentarioInfo = document.getElementById('modalComentarioInfo');
      if (comentarioInfo) comentarioInfo.remove();
      if (!modoCorrigir) {
        // Buscar o comentário da ação
        fetch(`/api/acoes/comentario/${acaoId}`)
          .then(r => r.json())
          .then(data => {
            if (data.comentario) {
              comentarioInfo = document.createElement('div');
              comentarioInfo.id = 'modalComentarioInfo';
              comentarioInfo.style.width = '100%';
              comentarioInfo.style.background = '#fffbe6';
              comentarioInfo.style.border = '1.5px solid #ffe066';
              comentarioInfo.style.borderRadius = '7px';
              comentarioInfo.style.padding = '1rem';
              comentarioInfo.style.marginBottom = '1rem';
              comentarioInfo.style.color = '#856404';
              comentarioInfo.style.fontWeight = '500';
              comentarioInfo.innerHTML = `<span style='font-size:1.08em;'>📝 <b>Comentário do revisor:</b><br>${data.comentario}</span>`;
              modalContent.insertBefore(comentarioInfo, modalContent.querySelector('#modalDocsLista'));
            }
          });
      }

      // Adicionar campo de comentário se for modo de correção
      let comentarioBox = document.getElementById('modalComentarioBox');
      if (comentarioBox) comentarioBox.remove();
      if (modoCorrigir) {
        comentarioBox = document.createElement('div');
        comentarioBox.id = 'modalComentarioBox';
        comentarioBox.style.width = '100%';
        comentarioBox.style.marginBottom = '1rem';
        comentarioBox.innerHTML = `
          <label for="modalComentario" style="font-weight:600;color:#4953b8;">Comentário para devolução:</label>
          <textarea id="modalComentario" rows="3" style="width:100%;border-radius:6px;border:1px solid #d1d5db;padding:0.7rem;font-size:1rem;margin-top:0.3rem;"></textarea>
          <small style="color:#888;">(Preencha este campo ao devolver para o estagiário)</small>
        `;
        modalContent.insertBefore(comentarioBox, modalContent.querySelector('#modalDocsLista'));
      }

      // Preencher lista de designados
      fetch('/api/designados').then(r => r.json()).then(designados => {
        const select = document.getElementById('modalDesignadoSelect');
        select.innerHTML = '<option value="Nenhum">Nenhum</option>';
        designados.forEach(e => {
          const opt = document.createElement('option');
          opt.value = e.nome;
          opt.textContent = e.nome;
          select.appendChild(opt);
        });
        // Setar valor atual
        select.value = window.__modalDesignadoAtual || 'Nenhum';
      });
      // Setar valor atual do status
      setTimeout(() => {
        document.getElementById('modalStatusSelect').value = statusAtual;
      }, 50);
      // Salvar status/designado/arquivo
      document.getElementById('modalStatusSalvar').onclick = async () => {
        const novoStatus = document.getElementById('modalStatusSelect').value;
        const novoDesignado = document.getElementById('modalDesignadoSelect').value;
        const msg = document.getElementById('modalStatusMsg');
        msg.textContent = 'Salvando...';
        let statusOk = false;
        // Se for modo de correção e status está saindo de finalizado, enviar comentário
        let comentarioEnviado = false;
        let comentario = '';
        if (modoCorrigir && statusAtual === 'Finalizado' && novoStatus !== 'Finalizado') {
          comentario = document.getElementById('modalComentario').value.trim();
          if (comentario.length > 0) {
            const respComentario = await fetch(`/api/acoes/comentario/${acaoId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ comentario })
            });
            comentarioEnviado = respComentario.ok;
          } else {
            msg.textContent = 'Por favor, escreva um comentário para devolução.';
            return;
          }
        }
        // Salvar status e designado
        const resp = await fetch(`/api/acoes/status/${acaoId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: novoStatus, designado: novoDesignado })
        });
        if (resp.ok) {
          statusOk = true;
        }
        // Salvar arquivos de todos os tipos, se houver
        let arquivoOk = true;
        const tiposUpload = [
          { campo: 'modalContratoUpload', rota: '/api/acoes/upload-contrato' },
          { campo: 'modalDocumentacaoUpload', rota: '/api/acoes/upload-documentacao' },
          { campo: 'modalProvasUpload', rota: '/api/acoes/upload-provas' },
          { campo: 'modalAcaoUpload', rota: '/api/acoes/upload-acao' }
        ];
        for (const tipo of tiposUpload) {
          const input = document.getElementById(tipo.campo);
          if (input && input.files && input.files.length) {
            const formData = new FormData();
            formData.append('acao_id', acaoId);
            formData.append('arquivo', input.files[0]);
            const respArq = await fetch(tipo.rota, {
              method: 'POST',
              body: formData
            });
            arquivoOk = arquivoOk && respArq.ok;
          }
        }
        if (statusOk && arquivoOk && (!modoCorrigir || novoStatus === 'Finalizado' || comentarioEnviado)) {
          msg.textContent = 'Salvo!';
          // Fechar o modal imediatamente após salvar
          document.getElementById('modalDocumentos').style.display = 'none';
          setTimeout(() => { msg.textContent = ''; }, 1200);
          if (modoCorrigir) {
            carregarKanbanCorrigir();
          } else {
            carregarKanban();
          }
        } else {
          msg.textContent = 'Erro ao salvar';
        }
      };
      // Botão Aprovar (corrigir)
      if (modoCorrigir) {
        document.getElementById('modalAprovar').onclick = async () => {
          const msg = document.getElementById('modalStatusMsg');
          msg.textContent = 'Aprovando...';
          const resp = await fetch(`/api/acoes/aprovar/${acaoId}`, { method: 'POST' });
          if (resp.ok) {
            msg.textContent = 'Aprovado!';
            // Fechar o modal imediatamente após aprovar
            document.getElementById('modalDocumentos').style.display = 'none';
            setTimeout(() => { msg.textContent = ''; }, 1200);
            carregarKanbanCorrigir();
          } else {
            msg.textContent = 'Erro ao aprovar';
          }
        };
      }
      // Mapear nomes para títulos
      // Descobrir designado atual (para setar no select)
      window.__modalDesignadoAtual = arquivosPorTipo && arquivosPorTipo.__designadoAtual ? arquivosPorTipo.__designadoAtual : 'Nenhum';
      const tipos = {
        'Contrato': arquivosPorTipo.Contrato || [],
        'Documentação': arquivosPorTipo.Documentacao || [],
        'Provas': arquivosPorTipo.Provas || [],
        'Ação': arquivosPorTipo.Acao || []
      };
      // Container dos blocos
      const blocos = document.createElement('div');
      blocos.className = 'modal-docs-tipos';
      Object.entries(tipos).forEach(([titulo, listaArqs]) => {
        const bloco = document.createElement('div');
        bloco.className = 'modal-docs-bloco';
        bloco.innerHTML = `<div class='modal-docs-bloco-titulo'>${titulo}</div>`;
        // Upload para qualquer tipo se não houver arquivo
        if (listaArqs.length === 0) {
          const tipoCampo =
            titulo === 'Contrato' ? 'modalContratoUpload' :
              titulo === 'Documentação' ? 'modalDocumentacaoUpload' :
                titulo === 'Provas' ? 'modalProvasUpload' :
                  titulo === 'Ação' ? 'modalAcaoUpload' : '';
          const uploadDrop = document.createElement('div');
          uploadDrop.className = 'modal-docs-upload-drop';
          uploadDrop.innerHTML = `
            <span class=\"icon\">📎</span>
            <span id=\"${tipoCampo}Label\">Arraste o arquivo aqui ou clique para selecionar</span>
            <span class=\"file-name\" id=\"${tipoCampo}Nome\"></span>
            <input type='file' id='${tipoCampo}' accept='.pdf,.doc,.docx,.png,.jpg,.jpeg' style='display:none;'>
          `;
          bloco.appendChild(uploadDrop);
          // Lógica de upload visual
          const input = uploadDrop.querySelector(`#${tipoCampo}`);
          const nomeSpan = uploadDrop.querySelector(`#${tipoCampo}Nome`);
          uploadDrop.onclick = () => input.click();
          input.addEventListener('change', () => {
            if (input.files.length) {
              nomeSpan.textContent = input.files[0].name;
            } else {
              nomeSpan.textContent = '';
            }
          });
          // Drag and drop
          uploadDrop.addEventListener('dragover', function (e) {
            e.preventDefault();
            uploadDrop.classList.add('dragover');
          });
          uploadDrop.addEventListener('dragleave', function (e) {
            uploadDrop.classList.remove('dragover');
          });
          uploadDrop.addEventListener('drop', function (e) {
            e.preventDefault();
            uploadDrop.classList.remove('dragover');
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
              input.files = e.dataTransfer.files;
              nomeSpan.textContent = input.files[0].name;
            }
          });
        }
        const arqsDiv = document.createElement('div');
        arqsDiv.className = 'modal-docs-arquivos';
        if (listaArqs.length === 0) {
          arqsDiv.innerHTML = `<div style='color:#888'>Nenhum arquivo.</div>`;
        } else {
          listaArqs.forEach(arq => {
            const card = document.createElement('div');
            card.className = 'modal-docs-arquivo-card';
            card.innerHTML = `
              <span class='modal-docs-arquivo-icon'>📄</span>
              <span class='modal-docs-arquivo-nome'>${arq.nome.replace(/^(CON|DOC|PROV|ACAO) - /, '')}</span>
              <a class='modal-docs-arquivo-link' href="${arq.path.replace(/^.*public/, '')}" target="_blank" title="Baixar">⬇️</a>
              <button class='modal-docs-arquivo-remove' title='Excluir' style='margin-left:0.7rem;color:#e53e3e;background:none;border:none;font-size:1.2em;cursor:pointer;font-weight:bold;'>×</button>
            `;
            // Evento de remover
            card.querySelector('.modal-docs-arquivo-remove').onclick = async (ev) => {
              ev.stopPropagation();
              if (!confirm('Tem certeza que deseja excluir este arquivo?')) return;
              const resp = await fetch('/api/acoes/remover-arquivo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ acaoId: acaoId, nomeArquivo: arq.nome })
              });
              if (resp.ok) {
                abrirDetalhesAcaoCorrigir(acaoId);
              } else {
                alert('Erro ao remover arquivo!');
              }
            };
            arqsDiv.appendChild(card);
          });
        }
        bloco.appendChild(arqsDiv);
        blocos.appendChild(bloco);
      });
      lista.appendChild(blocos);
      modal.style.display = 'flex';
    }

    function fecharModalDocumentos() {
      document.getElementById('modalDocumentos').style.display = 'none';
    }

    // Função para buscar clientes e estagiários (exemplo, ajustar para seu backend)
    async function carregarOpcoes() {
      // Buscar clientes
      const clientes = await fetch('/api/clientes').then(r => r.json()).catch(() => []);
      const selectCliente = document.getElementById('cliente');
      clientes.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = c.nome + ' - ' + c.cpf_cnpj;
        selectCliente.appendChild(opt);
      });
      // Buscar estagiários
      const designados = await fetch('/api/designados').then(r => r.json()).catch(() => []);
      const selectdesignado = document.getElementById('designado');
      designados.forEach(e => {
        const opt = document.createElement('option');
        opt.value = e.id;
        opt.textContent = e.nome;
        selectdesignado.appendChild(opt);
      });
    }
    carregarOpcoes();

    // Envio do formulário
    document.getElementById('formAcao').addEventListener('submit', async function (e) {
      e.preventDefault();

      // Criar FormData para enviar dados e arquivos
      const formData = new FormData();

      // Dados básicos
      formData.append('cliente_id', document.getElementById('cliente').value);
      formData.append('designado_id', document.getElementById('designado').value);
      formData.append('status', document.getElementById('status').value);
      formData.append('titulo', document.getElementById('titulo').value);

      // Arquivos
      const contratoFiles = document.getElementById('contratoArquivo').files;
      const documentacaoFiles = document.getElementById('documentacaoArquivo').files;
      const provasFiles = document.getElementById('provasArquivo').files;

      // Adicionar arquivos com campos separados para cada tipo
      for (let i = 0; i < contratoFiles.length; i++) {
        formData.append('contratoArquivo', contratoFiles[i]);
      }
      for (let i = 0; i < documentacaoFiles.length; i++) {
        formData.append('documentacaoArquivo', documentacaoFiles[i]);
      }
      for (let i = 0; i < provasFiles.length; i++) {
        formData.append('provasArquivo', provasFiles[i]);
      }

      const resp = await fetch('/api/acoes', {
        method: 'POST',
        body: formData
      });

      const data = await resp.json();

      if (resp.ok) {
        this.reset();
        // Limpar listas de arquivos
        document.getElementById('contratoArquivoLista').innerHTML = '';
        document.getElementById('documentacaoArquivoLista').innerHTML = '';
        document.getElementById('provasArquivoLista').innerHTML = '';
        // Exibir pop-up de sucesso
        mostrarPopupAcaoCriada(data.mensagem || 'Ação criada com sucesso!');
      } else {
        document.getElementById('mensagem').textContent = data.mensagem || 'Erro ao criar ação';
        document.getElementById('mensagem').style.color = '#dc3545';
      }
    });

    // Feedback visual ao enviar
    const form = document.getElementById('formAcao');
    const mensagem = document.getElementById('mensagem');
    form.addEventListener('submit', function () {
      mensagem.textContent = '';
    });
  </script>
  <script>
    // Gerenciamento de múltiplos arquivos e remoção
    function atualizarListaArquivos(inputId, listaId) {
      const input = document.getElementById(inputId);
      const lista = document.getElementById(listaId);
      lista.innerHTML = '';
      if (input.files && input.files.length > 0) {
        Array.from(input.files).forEach((file, idx) => {
          const item = document.createElement('div');
          item.className = 'file-list-item';
          item.innerHTML = `<span>${file.name}</span><button type="button" class="remove-file" title="Remover" data-idx="${idx}">×</button>`;
          lista.appendChild(item);
        });
        // Adiciona evento de remoção
        lista.querySelectorAll('.remove-file').forEach(btn => {
          btn.onclick = function (e) {
            e.stopPropagation();
            removerArquivo(inputId, parseInt(btn.getAttribute('data-idx')));
          };
        });
      }
    }

    function removerArquivo(inputId, idx) {
      const input = document.getElementById(inputId);
      const dt = new DataTransfer();
      Array.from(input.files).forEach((file, i) => {
        if (i !== idx) dt.items.add(file);
      });
      input.files = dt.files;
      // Atualiza lista
      atualizarListaArquivos(inputId, inputId + 'Lista');
    }

    document.getElementById('contratoArquivo').addEventListener('change', function () {
      atualizarListaArquivos('contratoArquivo', 'contratoArquivoLista');
    });
    document.getElementById('documentacaoArquivo').addEventListener('change', function () {
      atualizarListaArquivos('documentacaoArquivo', 'documentacaoArquivoLista');
    });
    document.getElementById('provasArquivo').addEventListener('change', function () {
      atualizarListaArquivos('provasArquivo', 'provasArquivoLista');
    });

    // Drag and drop para cada campo
    function setupDrop(dropId, inputId, labelId) {
      const drop = document.getElementById(dropId);
      const input = document.getElementById(inputId);
      const label = document.getElementById(labelId);
      drop.addEventListener('dragover', function (e) {
        e.preventDefault();
        drop.classList.add('dragover');
      });
      drop.addEventListener('dragleave', function (e) {
        drop.classList.remove('dragover');
      });
      drop.addEventListener('drop', function (e) {
        e.preventDefault();
        drop.classList.remove('dragover');
        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
          // Adiciona arquivos ao input mantendo os já existentes
          const dt = new DataTransfer();
          Array.from(input.files).forEach(f => dt.items.add(f));
          Array.from(e.dataTransfer.files).forEach(f => dt.items.add(f));
          input.files = dt.files;
          atualizarListaArquivos(inputId, inputId + 'Lista');
        }
      });
    }
    setupDrop('drop-contrato', 'contratoArquivo', 'contratoArquivoLabel');
    setupDrop('drop-documentacao', 'documentacaoArquivo', 'documentacaoArquivoLabel');
    setupDrop('drop-provas', 'provasArquivo', 'provasArquivoLabel');
  </script>
  <script src="js/script.js"></script>
  <script>
    // Função para mostrar notificação toast no canto inferior esquerdo
    function mostrarPopupAcaoCriada(msg) {
      let container = document.getElementById('toastContainer');
      if (!container) {
        container = document.createElement('div');
        container.id = 'toastContainer';
        container.style.position = 'fixed';
        container.style.bottom = '24px';
        container.style.left = '24px';
        container.style.zIndex = '3000';
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.gap = '12px';
        document.body.appendChild(container);
      }
      const toast = document.createElement('div');
      toast.className = 'toast-acao-criada';
      toast.style.background = '#fff';
      toast.style.borderLeft = '6px solid #28a745';
      toast.style.borderRadius = '10px';
      toast.style.boxShadow = '0 4px 16px rgba(40,167,69,0.13)';
      toast.style.padding = '1.1rem 1.7rem 1.1rem 1.2rem';
      toast.style.minWidth = '220px';
      toast.style.maxWidth = '340px';
      toast.style.fontSize = '1.08rem';
      toast.style.color = '#222';
      toast.style.fontWeight = '500';
      toast.style.display = 'flex';
      toast.style.alignItems = 'center';
      toast.style.gap = '0.7rem';
      toast.innerHTML = `<span style='font-size:1.6rem;color:#28a745;'>✅</span> <span>${msg}</span>`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.transition = 'opacity 0.4s';
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 400);
      }, 2200);
    }
  </script>
</body>

</html>